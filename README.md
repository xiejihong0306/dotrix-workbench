# DOTRIX PDF水印工具

本工具用于为PDF文件添加水印，支持文本和图片水印。

## 新功能: 安全水印

现在添加了安全水印功能，使水印无法被轻易删除。

### 安全水印原理

普通水印可以被PDF编辑器轻易选中和删除，安全水印通过以下技术解决这个问题：

1. 将PDF页面渲染为高分辨率图像
2. 在图像上添加水印
3. 将带有水印的图像转换回PDF

这种方式让水印成为图像的一部分，无法被选择工具识别和删除。

## 安装说明

### 安装依赖项

本程序需要以下依赖项：
- PyQt5: 用户界面
- Pillow: 图像处理
- PyPDF2: PDF处理
- reportlab: PDF生成
- PyMuPDF: 安全水印功能

**方式一：使用安装脚本（推荐）**

运行安装脚本自动安装所有依赖项：
```
python install_deps.py
```

**方式二：手动安装**

使用pip手动安装依赖项：
```
pip install -r requirements.txt
```

**特别注意**：如果要使用安全水印功能，必须正确安装PyMuPDF库：
```
pip install pymupdf
```

## 使用方法

1. 安装依赖: `python install_deps.py`
2. 运行程序: `python app.py`
3. 添加PDF文件（拖放或使用"添加PDF"按钮）
4. 设置水印参数（学生名、日期等）
5. 选择输出目录
6. 勾选"启用安全水印"选项（如需防止水印被删除）
7. 点击"批量处理"按钮

## 故障排除

### 安全水印处理失败

如果在使用安全水印功能时遇到问题：

1. **确认PyMuPDF已正确安装**
   运行以下命令检查是否安装成功：
   ```
   python -c "import fitz; print(fitz.version)"
   ```
   
2. **大文件导致内存不足**
   安全水印功能需要将PDF转换为图像，对于大文件或多页PDF可能需要较多内存。
   - 尝试关闭其他程序释放内存
   - 一次处理较少的文件
   - 如果问题仍然存在，可以使用普通水印方式（不勾选"安全水印"选项）

3. **PDF文件被加密或受保护**
   某些受保护的PDF可能无法处理。尝试先解除PDF保护，或使用普通水印功能。

4. **依赖库冲突**
   在某些情况下，不同版本的库可能存在冲突。尝试重新运行安装脚本：
   ```
   python install_deps.py
   ```

如果问题仍然存在，请检查程序显示的详细错误信息，以帮助确定具体的失败原因。

### 注意事项

- 安全水印会增加输出文件体积
- 安全水印处理后PDF中的文本将不再可选择和搜索
- 处理较大PDF文件时需要更多内存
- 处理多页PDF时需要更长的时间 